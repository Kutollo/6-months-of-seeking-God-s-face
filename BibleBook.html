<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bible Reading Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .day { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 8px; }
    .day-header { display: flex; justify-content: space-between; align-items: center; }
    textarea { width: 100%; margin-top: 8px; height: 60px; }
    .btn { padding: 6px 12px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .btn:hover { background: #45a049; }
    .progress { margin: 15px 0; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ðŸ“– Bible Reading Tracker</h1>

  <label for="bookSelect">Choose a Book:</label>
  <select id="bookSelect">
    <option value="">--Select--</option>
    <option value="Genesis">Genesis (50)</option>
    <option value="Exodus">Exodus (40)</option>
    <option value="Psalms">Psalms (150)</option>
    <option value="Proverbs">Proverbs (31)</option>
    <option value="Ruth">Ruth (4)</option>
  </select>

  <label for="monthSelect">Choose a Month:</label>
  <select id="monthSelect">
    <option value="">--Select--</option>
    <option value="January">January</option>
    <option value="February">February</option>
    <option value="March">March</option>
    <option value="April">April</option>
    <option value="May">May</option>
    <option value="June">June</option>
    <option value="July">July</option>
    <option value="August">August</option>
    <option value="September">September</option>
    <option value="October">October</option>
    <option value="November">November</option>
    <option value="December">December</option>
  </select>

  <button class="btn" onclick="generatePlan()">Generate Plan</button>
  <button class="btn" onclick="exportPDF()">Download Full PDF</button>

  <div class="progress" id="progressTracker"></div>
  <div id="planContainer"></div>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const bibleChapters = {
      "Genesis": 50,
      "Exodus": 40,
      "Psalms": 150,
      "Proverbs": 31,
      "Ruth": 4
    };

    function saveProgress(book,month,day){
      const key=`${book}_${month}_2025_day${day}`;
      localStorage.setItem(key, document.getElementById("day"+day).checked);
      updateProgress();
    }

    function updateProgress(){
      const book=document.getElementById("bookSelect").value;
      const month=document.getElementById("monthSelect").value;
      if(!book||!month) return;
      let total=30, done=0;
      for(let i=1;i<=30;i++){
        if(localStorage.getItem(`${book}_${month}_2025_day${i}`)==="true") done++;
      }
      document.getElementById("progressTracker").innerText=`Progress: ${done}/30 days completed (${Math.round(done/30*100)}%)`;
    }

    function generatePlan(){
      const book=document.getElementById("bookSelect").value;
      const month=document.getElementById("monthSelect").value;
      if(!book||!month) return;

      const planContainer=document.getElementById("planContainer");
      planContainer.innerHTML="";

      const totalChapters=bibleChapters[book];
      const base=Math.floor(totalChapters/30);
      let remainder=totalChapters%30;
      let chapter=1;

      for(let day=1; day<=30; day++){
        let chaptersToday=base;

        if(remainder>0){
          chaptersToday+=1;
          remainder--;
        }

        let readingText;

        if(chapter<=totalChapters){
          let start=chapter;
          let end=Math.min(chapter+chaptersToday-1,totalChapters);

          // last day: dump all remaining chapters
          if(day===30 && end<totalChapters){
            end=totalChapters;
          }

          chapter=end+1;
          readingText=`Read ${book} ${start}${start!==end?' - '+end:''}`;
        } else {
          readingText="âœ¨ Reflection / Catch-up Day";
        }

        const div=document.createElement("div");
        div.className="day";
        div.innerHTML=`
          <div class="day-header">
            <div>
              <input type="checkbox" id="day${day}" onchange="saveProgress('${book}','${month}',${day})">
              <label for="day${day}">Day ${day}: ${readingText}</label>
            </div>
            <button class="btn" onclick="exportDayPDF(${day})">Download Day PDF</button>
          </div>
          <textarea id="reflection${day}" placeholder="Reflection for Day ${day}..."></textarea>
        `;
        planContainer.appendChild(div);

        // restore
        const savedCheck=localStorage.getItem(`${book}_${month}_2025_day${day}`);
        if(savedCheck==="true") document.getElementById("day"+day).checked=true;

        const savedRef=localStorage.getItem(`${book}_${month}_2025_reflection_day${day}`);
        if(savedRef) document.getElementById("reflection"+day).value=savedRef;

        document.getElementById("reflection"+day).addEventListener('input',()=>{
          localStorage.setItem(`${book}_${month}_2025_reflection_day${day}`,document.getElementById("reflection"+day).value);
        });
      }

      updateProgress();
    }

    async function exportPDF(){
      const { jsPDF }=window.jspdf;
      const doc=new jsPDF();
      const book=document.getElementById("bookSelect").value;
      const month=document.getElementById("monthSelect").value;
      doc.text(`Bible Reading Plan - ${book} (${month} 2025)`,10,10);

      let y=20;
      for(let day=1;day<=30;day++){
        const label=document.querySelector("label[for='day"+day+"']");
        if(!label) continue;
        const reflection=document.getElementById("reflection"+day).value;
        doc.text(`${label.innerText}`,10,y); y+=8;
        if(reflection){ doc.text(`Reflection: ${reflection}`,10,y); y+=8; }
        if(y>270){ doc.addPage(); y=20; }
      }

      doc.save(`${book}_${month}_2025_Plan.pdf`);
    }

    async function exportDayPDF(day){
      const { jsPDF }=window.jspdf;
      const doc=new jsPDF();
      const book=document.getElementById("bookSelect").value;
      const month=document.getElementById("monthSelect").value;
      const label=document.querySelector("label[for='day"+day+"']");
      const reflection=document.getElementById("reflection"+day).value;
      doc.text(`Bible Reading - ${book} (${month} 2025)`,10,10);
      doc.text(`${label.innerText}`,10,20);
      if(reflection){ doc.text(`Reflection: ${reflection}`,10,30); }
      doc.save(`${book}_${month}_2025_Day${day}.pdf`);
    }
  </script>
</body>
</html>
